apiVersion: "2021-10-01"
location: australiaeast
name: pm7y-n8n
properties:
  containers:
    - name: pm7y-n8n-aci
      properties:
        environmentVariables:
          - name: GENERIC_TIMEZONE
            value: Australia/Brisbane
          - name: TZ
            value: Australia/Brisbane
          - name: N8N_AI_ENABLED
            value: true
          - name: N8N_DIAGNOSTICS_ENABLED
            value: true
          - name: N8N_LOG_OUTPUT
            value: console,file
          - name: WEBHOOK_URL
            value: https://pm7y-n8n.bxe3dpbshwh7gjfc.australiaeast.azurecontainer.io/
        image: docker.io/n8nio/n8n:1.57.0
        ports:
          - port: 5678
            protocol: tcp
        resources:
          requests:
            cpu: 1.0
            memoryInGB: 2
        volumeMounts:
          - mountPath: /home/node/.n8n
            name: n8nvolume
            readOnly: false
    - name: pm7y-caddy-aci
      properties:
        environmentVariables: []
        image: docker.io/caddy:2.8.4-alpine
        command:
          [
            "caddy",
            "reverse-proxy",
            "--from",
            "pm7y-n8n.bxe3dpbshwh7gjfc.australiaeast.azurecontainer.io",
            "--to",
            "localhost:5678",
          ]
        ports:
          - port: 443
            protocol: tcp
        resources:
          requests:
            cpu: 0.5
            memoryInGB: 0.5
        volumeMounts:
          - mountPath: /data
            name: caddyvolume
            readOnly: false
  osType: Linux
  restartPolicy: Never
  ipAddress:
    type: Public
    ports:
      - protocol: tcp
        port: 443
    dnsNameLabel: pm7y-n8n
    autoGeneratedDomainNameLabelScope: ResourceGroupReuse
  # subnetIds:
  #   - id: /subscriptions/9dfa5b80-9e59-46c1-80fb-fec94378b3cd/resourceGroups/ContainerApps/providers/Microsoft.Network/virtualNetworks/pm7y-n8n-vnet/subnets/default
  #     name: default
  volumes:
    - name: n8nvolume
      azureFile:
        sharename: n8n-file-share
        storageAccountName: pm7ycae
        storageAccountKey:
    - name: caddyvolume
      azureFile:
        sharename: caddy-file-share
        storageAccountName: pm7ycae
        storageAccountKey:
tags: {}
type: Microsoft.ContainerInstance/containerGroups
